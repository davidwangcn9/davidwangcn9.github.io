---
layout:     post
title:      支付欺诈与3DS
subtitle:   支付欺诈
date:       2022-09-06
author:     大风哥
header-img: img/fraudpayment.png
catalog: true
tags:
    - 支付欺诈
    - 3DS
    - 卡支付
---

* [支付欺诈](#支付欺诈)
    * [什么是支付欺诈](#什么是支付欺诈)
    * [支付欺诈的最终受害者](#支付欺诈的最终受害者)
    * [支付欺诈如何发生](#支付欺诈如何发生) 
    * [如何预防或制止支付欺诈](#如何预防或制止支付欺诈)
    * [防范支付欺诈的产品](#防范支付欺诈的产品)
* [责任转移](#责任转移)
* [3DS](#3ds)

# 支付欺诈

## 什么是支付欺诈

支付欺诈是指某些人通过使用盗取自他人支付信息进行的不合规、不合法的支付行为。当然了，支付欺诈不仅仅只包含支付过程，还有后续一系列事情，比如退款，追责，诉讼等等。

电子支付打开了一扇门，使得支付变得方便又容易，可是凡事都有两面性，它也带来了支付欺诈，成为支付系统中的毒瘤与噩梦。

让我们快速看一批数字来了解一下支付欺诈对支付行业的影响吧：
- 2018年，全球82%的公司收到支付欺诈的影响
- Juniper Research报道，截止2023年，由于支付欺诈导致的经济损失将达到480亿美刀
- 每$1支付欺诈引起的退款，都会产生额外$2.94的商业损失（包括但不限于退款费，欺诈调查，法律追溯，安全软件等）


以上这些数字还是非常显著的体现了支付欺诈的“重要”影响。

## 支付欺诈的最终受害者
谁是欺诈的最终受害者？ 要回答这个问题，还是需要对支付欺诈有更进步一的了解才可以，如下图
![pic](/img/fraud-payment-1.png)

$\color{#4285f4}{首先小偷（蓝色线）}$： step1获取了重要的支付信息后，（也就是我们常说的PCI数据）就会进行step 2，从而通过step3非法获取到商品

$\color{#ea4335}{然后持卡人（红色线）}$：step1报告欺诈行为并向发卡行申报要求退款，然后发卡行就会进行step2要求商家就行退款

所以谁才是最终受害者？没错，最惨的就是商家，可谓是财货两丢，更痛苦的是还要支付由于发卡行发起的退款手续费。

## 支付欺诈如何发生
又有哪些情况会发生支付欺诈呢？

你可能会问，不就是小偷盗取信息呗，对，不过这不是唯一的情况，在国外还有以下这些很常见的场景：
- 自导自演，俗称friendly fraud，就是先买，然后声称没收到，继而去银行要求退款
- 钓鱼网站，支付者以为支付正常，结果支付后产品却寄给了欺诈者
- 暗网，暗网上有大量的被盗卡信息，截止2013年，大约有1.4亿份卡信息被盗

## 如何预防或制止支付欺诈

其实在当今的市场上，有很多现成的防支付欺诈的产品与软件，所以绝大多数的公司都会选择从现有的专业产品中选择一两款就行集成，已达到安全支付的标准与基线。所谓小投入，大回报，相比于处理由于支付欺诈导致的后续一系列问题甚至名声受损，集成专业软件已经是大部分支付产品或平台的首选。

就目前市场上的防欺诈产品来说，无非是采用以下这几种方式实现预防支付欺诈

- 不断加强的规则引擎 Rule Engine
- 机器学习
- 图形数据库进行链接分析

看着上面的方法都很复杂且高大上，其实最终的实现原理是一致，即帮助判断一笔支付是否有风险，然后基于经验或数据对风险进行评判，决定是否继续这笔支付。

然而实际情况是并不是越严格越好，有时候严格会使得支付率降低，误判一些正常的支付为欺诈支付，使得结单率下降；不严格的话，又会导致防不住支付欺诈。所以评判标准的拿捏还是很有门道的，所以很多大公司都用机器学习帮助甄别。

 

总结一下，验证支付欺诈就是就在在尝试回答两个问题

- Who  you are？ 支付者是不是真的支付者
    - 一般通过OTP短息验证，手机验证，生物验证（指纹，虹膜等）
- Can you do ？ 支付者是否可以做这笔支付
    - 一般检验这笔支付是否符合预定的一些条件，比如说如果预设在一个用户在1个月内不会超过1w的支付，但是如果这笔会使支付总额超过，这笔支付就会拦截下来。

## 防范支付欺诈的产品
市场上，针对支付欺诈的软件还是很多的，以下就是一些我们在项目上用的，以及听到过的一些比较有名的产品。

![pic](/img/fraud-product.png)

当然了，这里还是强烈推荐其中一个产品，也可以说是妥妥的行业标准，即EMVCo 3-D Secure. 虽然说各种产品各自有各自的特点，有些擅长统计报表，有些支持更多的支付网关（或者说支付网关直接集成了，用不用只有这个），有些的规则更容易维护。不过EMVCo 3-D Secure 具有个非常重要且独特的点，即责任转移 （liability shift），是所有其他产片所不具备的。（当然也不是说一个产品只3-D Secure就够了，3-D Secure更偏解决Who you are，对Can you do的支持不够，所有很多公司一般不仅集成3-D Secure，还会额外集成一个防欺诈产品用于解决Can you do的问题。）

 

这里就不得不提一提责任转移 （liability shift）.

# 责任转移

责任转移是指当支付时使用3D Secure的手段，发生支付欺诈所产生损失的责任由商户转移到发卡行。说的大白话一些，就是如果使用了3DS，且真的发生了支付欺诈且没防住，那么商家不需要承担所有损失，退款（charge back）将由发卡行承担。确实这是商家的福音，不过天下没有免费的午餐，一旦使用3DS，那么所有支付时是需要缴纳服务费的。

依托于3DS本身的防欺诈功能，就可以杜绝绝大多数的欺诈支付，但如果还是发生了支付欺诈，这个时候发卡行就需要承担相应的退款责任了。这也是为什么3DS产品会异军突起的主要原因了。

# 3DS

3DS实际上是一套协议，由CA Technology和Visa联合提出并实现，当时简称3DS1.0， 被各大卡组织渐渐普遍接受并支持。3DS1.0由于很多短板，比如说每次支付都需要验证，导致支付交易过程复杂化，转化率（点击/购买）的降低，同时仅支持基于浏览器的支付，而不支持APP内发起的支付。这些严重的缺点，促使了3DS2.0的诞生，也就是上面提到的这个产品EMVCo 3-D Secure，或者我们俗称的3DS2.0。（3DS1.0没落的另一个原因也是越来越多的卡组织停止对其的支持，也导致了很多支付方面的变化。）


3DS2.0的优点是支持In-APP的支付，执行基于风险的决策，从而使客户极大减少与发卡行之间做额外身份验证，并提高的用户支付体，同时还支持非付款客户的认证，用于移动钱包持卡人识别和验证。

 
3DS2.0的主要工作原理如下：
![pic](/img/fraud-3ds.png)

上面有些关键名词，比如

DS：Directory Server，一般是由各个卡组织提供，比如VISA的DS，Master Card的DS等，支付时连接哪个DS取决于支付的卡所支持的卡组织。

ACS：Access Control Server，一般由发卡行提供，比如HSBC银行，ANZ银行，工商银行，招商银行等

Acquirer：支付处理机构
整个流程分为两大部分：

- 验证
    - 无摩擦流程（Frictionless flow）
    - 挑战流程（Challenge flow）
- 支付

也就是只用通过了验证，才可以决定是否需要支付。以下是各个步骤概述：

- 步骤1-3：开始交易并向DS server发送认证请求， ACS会对这次认证请求进行基于风险的校验。
- 步骤4-5：如果需要，发卡行发起认证。
- 步骤6：身份验证的结果通过通过DS（v2.0）传达- CReq
- 步骤7：身份验证的发送到网页- RRes
- 步骤6-7：完成流程。 在此之后，遵循正常的支付流程（虚线）。

整个过程中会产生一系列请求和响应，这里是总结的这些重要的请求/响应对以及它们的作用，希望对才接触3DS2.0的小伙伴能有帮助

|  阶段   | 请求/响应  |
|  ----  | ----  |
| 预报  | PReq/PRes |
| 认证  | AReq/ARes |
| 盘问  | CReq/CRes |
| 结果  | RReq/RRes |

对于需要维护或者实现自己的支付网关的小伙伴，上面这些3DS2.0的知识可能只是一个基础，还需要研读文档，进行3DS2.0对支付网关的集成，集成之后还需要与各个卡组织（VISA，MasterCard等）做3DS2.0的集成验证（考虑到时区，卡组织的支持力度，奇葩的测试用例等，过程非常痛苦），当然如果找到现成的集成验证解决方案提供商（花钱解决问题），又另当别论了。在测试环境集成验证成功后，3DS2.0才算是集成成功。


对于使用现成支付网关且支付网关已经集成了3DS2.0的小伙伴，恭喜你们，你们很幸福，上面这些知识基本已经足够了，可以帮助梳理整个流程。

以上就是支付欺诈与3DS的内容。希望大家读到这里对一开始的几个问题都有了相应的答案。


